jQuery(function(a){if("undefined"!=typeof braintree_hosted_fields_vars){var b={container:".payment_method_"+braintree_hosted_fields_vars.gateway_id,new_method_container:".bfwc-new-payment-method-container",token_selector:".bfwc-payment-method-token",nonce_selector:".bfwc-nonce-value",device_data_selector:".bfwc-device-data",icon_style:braintree_hosted_fields_vars.dynamic_card_display.icon_style,init:function(){this.assign_parent_class(),setInterval(this.check_hosted_fields,1500),a(b.container).closest("form").on("checkout_place_order_"+braintree_hosted_fields_vars.gateway_id,this.woocommerce_form_submit),a(document.body).on("updated_checkout",this.check_hosted_fields),a(document.body).on("updated_checkout",this.maybe_update_vars),a(b.container).closest("form").on("woocommerce_form_submit_"+braintree_hosted_fields_vars.gateway_id,this.woocommerce_form_submit),a(b.container).closest("form").on("woocommerce_form_submit_"+braintree_hosted_fields_vars.gateway_id,this.maybe_set_device_data),a(document.body).on("bfwc_pre_form_submit_"+braintree_hosted_fields_vars.gateway_id,this.maybe_set_device_data),a(document.body).on("checkout_error",this.checkout_error),a(document.body).on("braintree_checkout_initiated",this.display_loader),a(document.body).on("braintree_tokenization_error",this.remove_loader),a(document.body).on("checkout_error",this.remove_loader),braintree_hosted_fields_vars.dynamic_card_display.enabled&&a(document.body).on("braintree_card_type_change",this.card_type_change),a(document.body).on("click","#place_order",this.submit_payment_method),this.initialize_functionality()},assign_parent_class:function(){a('input[name="payment_method"]').each(function(){var b=a(this).val();a(this).closest("li").hasClass("payment_method_"+b)||a(this).closest("li").addClass("payment_method_"+b)})},initialize_functionality:function(){if("undefined"==typeof braintree_hosted_fields_client_token)return void this.submit_error({code:"INVALID_CLIENT_TOKEN"});a(document.body).trigger("braintree_before_form_initialize"),braintree.client.create({authorization:braintree_hosted_fields_client_token},function(a,c){if(a)return void b.submit_error(a);b.clientInstance=c,b.initialize_hosted_instance(),b.initialize_fraud_tools(),b.initialize_3d_secure()})},initialize_hosted_instance:function(){a(b.container).length&&b.clientInstance&&braintree.hostedFields.create({client:b.clientInstance,styles:braintree_hosted_fields_vars.form_styles,fields:b.get_hosted_fields()},function(c,d){if(c){if("HOSTED_FIELDS_FIELD_DUPLICATE_IFRAME"===c.code)return;return void b.submit_error(c)}b.hostedFieldsInstance=d,b.hostedFieldsInstance.on("validityChange",b.validity_change),b.hostedFieldsInstance=d,a.each(b.events,function(b,c){d.on(b,function(b){a(document.body).triggerHandler(c,b)})})})},initialize_3d_secure:function(){braintree_hosted_fields_vars._3ds.enabled&&braintree.threeDSecure.create({client:b.clientInstance},function(c,d){if(c)return b.threeds_error=c,void b.submit_error(c);b.threeDSecureInstance=d,a("body").addClass("bfwc-3ds")})},submit_payment_method:function(c){if(b.is_gateway_selected())if(b.is_payment_method_selected()){if(a(document.body).triggerHandler("braintree_checkout_initiated"),!braintree_hosted_fields_vars._3ds.active||!braintree_hosted_fields_vars._3ds.verify_vault)return!0;c.preventDefault(),b.process_3dsecure_vaulted()}else c.preventDefault(),b.tokenize_method()},tokenize_method:function(c){a(document.body).triggerHandler("braintree_checkout_initiated"),b.hostedFieldsInstance.tokenize(function(a,c){if(a)return b.submit_error(a),void b.handle_tokenization_error(a);braintree_hosted_fields_vars._3ds.active?b.process_3dsecure(c):b.on_payment_method_received(c)})},submit_error:function(c){a(document.body).triggerHandler("bfwc_submit_error",{error:c,element:b.container,fields:b.get_hosted_fields()})},process_3dsecure:function(c){b.threeDSecureInstance?b.threeDSecureInstance.verifyCard({amount:a("#bfwc_cart_total").length?a("#bfwc_cart_total").val():braintree_hosted_fields_vars.order_total,nonce:c.nonce,addFrame:b.add_3ds_frame,removeFrame:b.remove_3ds_frame},function(a,c){if(a)return b.submit_error(a),void b.remove_loader();b.remove_3ds_frame(),b.on_payment_method_received(c),b.display_loader()}):b.submit_error(b.threeds_error)},process_3dsecure_vaulted:function(){b.block_form(),a.when(b.payment_nonce_request(b.get_payment_token())).done(function(a){a.success?b.process_3dsecure({nonce:a.data}):(b.submit_error(a.data),b.unblock_form())}).fail(function(a,c,d){b.submit_error({message:d}),b.unblock_form()})},handle_tokenization_error:function(c){"HOSTED_FIELDS_FIELDS_INVALID"===c.code?a.each(c.details.invalidFieldKeys,function(c,d){var e=b.get_hosted_fields()[d];a(e.selector).braintreeInvalidField()}):"HOSTED_FIELDS_FIELDS_EMPTY"===c.code&&a.each(b.get_hosted_fields(),function(b,c){a(c.selector).braintreeInvalidField()}),a(document.body).trigger("braintree_tokenization_error",{err:c,fields:b.get_hosted_fields()})},initialize_fraud_tools:function(){braintree_hosted_fields_vars.advanced_fraud.enabled&&braintree.dataCollector.create({client:b.clientInstance,kount:!0,paypal:!0},function(a,c){if(a)return void b.submit_error(a);b.dataCollectorInstance=c})},on_payment_method_received:function(c){b.payment_method_received=!0,a(b.container).find(b.nonce_selector).val(c.nonce),a(b.container).closest("form").submit()},check_hosted_fields:function(){b.assign_parent_class(),a(b.container).find(b.new_method_container).find("iFrame").length||b.initialize_hosted_instance(),b.check_container_size()},check_container_size:function(){a(".payment_methods").width()<475?a("div.braintree-payment-gateway").addClass("small-container"):a("div.braintree-payment-gateway").removeClass("small-container"),a(document.body).trigger("bfwc_container_size_check",b.get_hosted_fields())},get_hosted_fields:function(){return b.hosted_fields||(b.hosted_fields={},a.each(braintree_hosted_fields_vars.custom_fields,function(c,d){a(d.selector).length&&(d.placeholder=a(d.selector).attr("data-placeholder"),b.hosted_fields[c]=d)})),b.hosted_fields},checkout_error:function(){b.payment_method_received=!1},is_payment_method_selected:function(){return a(b.container).find(b.token_selector).length>0&&""!==a(b.container).find(b.token_selector).val()},is_gateway_selected:function(){return a('input[name="payment_method"]:checked').val()===braintree_hosted_fields_vars.gateway_id},get_payment_token:function(){return a(b.container).find(b.token_selector).val()},teardown:function(a){if(b.hostedFieldsInstance)try{b.hostedFieldsInstance.teardown(function(){b.payment_method_received=!1,a&&a()})}catch(c){b.payment_method_received=!1,a&&a()}},woocommerce_form_submit:function(){return!!b.is_payment_method_selected()||!!b.payment_method_received},maybe_update_vars:function(c){if(braintree_hosted_fields_vars._3ds.enabled){b.block_form();var d={bfwc_handle:"hosted-fields",security:braintree_hosted_fields_vars.update_checkout_nonce,billing_country:a("#billing_country").val(),shipping_country:a("#shipping_country").val()};a.ajax({type:"POST",url:braintree_hosted_fields_vars.wc_ajax_url.toString().replace("%%endpoint%%","bfwc_updated_checkout"),data:d,success:function(a){b.unblock_form(),a.success&&(braintree_hosted_fields_vars=a.data)},error:function(a,c,d){b.unblock_form()}})}},payment_nonce_request:function(b){return a.ajax({type:"POST",url:braintree_hosted_fields_vars.wc_ajax_url.toString().replace("%%endpoint%%","generate_payment_nonce"),data:{security:braintree_hosted_fields_vars.payment_method_nonce,bfwc_payment_token:b}})},maybe_set_device_data:function(){return b.dataCollectorInstance&&a(b.container).find(b.device_data_selector).val(b.dataCollectorInstance.deviceData),!0},add_3ds_frame:function(c,d){if(c)return void b.submit_error(c);b.remove_loader(),a("body").prepend('<div class="braintree-3ds-overlay"></div>'),a("body .braintree-3ds-overlay").fadeIn(400),a("body").prepend(braintree_hosted_fields_vars._3ds.modal_html),a(".threeDS-frame-body").append(d),a("#braintree_3ds_hosted_modal").fadeIn(400),a(".threeDS-cancel").on("click",b.remove_3ds_frame)},remove_3ds_frame:function(c){a("body .braintree-3ds-overlay").fadeOut(400,function(){a(this).remove()}),a("body .threeDS-hosted-modal").fadeOut(400,function(){a(this).remove()}),b.unblock_form(),b.threeDSecureInstance.cancelVerifyCard(function(a,c){if(a)return void b.submit_error(a)})},display_loader:function(){braintree_hosted_fields_vars.loader.enabled&&a(".bfwc-payment-loader").fadeIn(200)},remove_loader:function(){a(".bfwc-payment-loader").fadeOut(200)},block_form:function(){a(b.container).closest("form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock_form:function(){a(b.container).closest("form").unblock()},events:{validityChange:"braintree_field_validity_change",cardTypeChange:"braintree_card_type_change",empty:"braintree_field_empty",notEmpty:"braintree_field_not_empty",focus:"braintree_field_focus",blur:"braintree_field_blur",inputSubmitRequest:"braintree_card_input_submit_request"},card_type_change:function(c,d){1===d.cards.length?(a(".bfwc-card-type").attr("class","bfwc-card-type").addClass(b.icon_style+" "+d.cards[0].type),b.current_card_type=d.cards[0].type):a(".bfwc-card-type").attr("class","bfwc-card-type")},validity_change:function(b){var c=b.fields[b.emittedBy];c.isValid||!c.isValid&&!c.isPotentiallyValid?a(c.container).removeClass("braintree-hosted-fields-focused"):a(c.container).addClass("braintree-hosted-fields-focused")}};b.init(),a.fn.braintreeInvalidField=function(){a(this).addClass("braintree-hosted-fields-invalid")}}});