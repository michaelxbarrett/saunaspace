jQuery(function(e){if("undefined"!=typeof braintree_paypal_vars){var t={container:".payment_method_"+braintree_paypal_vars.gateway_id,button_id:"#braintree_paypal_button",token_selector:".bfwc-payment-method-token",tokenized_selector:".bfwc-tokenized-paypal-method",nonce_selector:".bfwc-nonce-value",device_data_selector:".bfwc-device-data",init:function(){this.assign_parent_class(),this.order_button_text=e("#place_order").val(),e(document.body).on("bfwc_payment_method_selected",t.change_order_button_text),e(document.body).on("click",t.button_id+", .bfwc-paypal-tokenize",t.tokenize_method),e(document.body).on("click",".bfwc-paypal-cancel",t.remove_method),e(document.body).on("bfwc_display_new_payment_method_container",this.display_new_method),e(document.body).on("bfwc_display_saved_methods",this.display_saved_methods),e(document.body).on("checkout_error",this.checkout_error),e(t.container).closest("form").on("checkout_place_order_"+braintree_paypal_vars.gateway_id,this.woocommerce_form_submit),e(document.body).on("updated_checkout",this.maybe_update_vars),e(document.body).on("bfwc_pre_form_submit_"+braintree_paypal_vars.gateway_id,this.set_device_data),e(this.container).closest("form").on("woocommerce_form_submit_"+braintree_paypal_vars.gateway_id,this.woocommerce_form_submit),e(this.container).closest("form").on("woocommerce_form_submit_"+braintree_paypal_vars.gateway_id,this.set_device_data),this.initialize_paypal()},assign_parent_class:function(){e('input[name="payment_method"]').each(function(){var t=e(this).val();e(this).closest("li").hasClass("payment_method_"+t)||e(this).closest("li").addClass("payment_method_"+t)})},initialize_paypal:function(){"undefined"!=typeof braintree_paypal_client_token?braintree.client.create({authorization:braintree_paypal_client_token},function(e,a){e?t.submit_error(e):(t.clientInstance=a,t.initialize_fraud_tools(),braintree.paypal.create({client:t.clientInstance},function(e,a){e?t.submit_error(e):t.paypalInstance=a}))}):this.submit_error({code:"INVALID_CLIENT_TOKEN"})},initialize_fraud_tools:function(){braintree.dataCollector.create({client:t.clientInstance,paypal:!0},function(e,a){e?t.submit_error(e):t.dataCollectorInstance=a})},tokenize_method:function(e){e.preventDefault(),t.paypalInstance.tokenize(t.get_tokenization_options(),function(e,a){if(e){if("PAYPAL_POPUP_CLOSED"===e.code)return;return"PAYPAL_INVALID_PAYMENT_OPTION"===e.code&&e.details.originalError.details.originalError.paymentResource.errorDetails&&(e.code=e.code+"_ADDRESS"),void t.submit_error(e)}t.on_payment_method_recieved(a)})},on_payment_method_recieved:function(a){t.payment_method_received=!0;var n=e(t.container).find(t.tokenized_selector),o=e(braintree_paypal_vars.html);e(o).find(".payment-method-description").text(a.details.email),n.append(o),e(t.container).find(".braintree-paypal-button").slideUp(400),n.slideDown(400),e(t.container).find(t.nonce_selector).val(a.nonce),e("#place_order").removeClass("bfwc-paypal-tokenize").val(t.order_button_text),braintree_paypal_vars.form.submit&&e(t.container).closest("form").submit()},get_tokenization_options:function(){var t=braintree_paypal_vars.options;if(t.enableShippingAddress&&(e('[name^="shipping_"]').length||e('[name^="billing_"]').length)){var a=e('[name^="shipping_"]').length&&e('[name="ship_to_different_address"]').is(":checked")?"#shipping_":"#billing_";t.shippingAddressOverride={recipientName:e(a+"first_name").val()+" "+e(a+"last_name").val(),line1:e(a+"address_1").val(),line2:e(a+"address_2").val(),city:e(a+"city").val(),countryCode:e(a+"country").val(),postalCode:e(a+"postcode").val(),state:e(a+"state").val(),phone:e(a+"phone").val()}}return t.amount=e("#bfwc_cart_total").length?e("#bfwc_cart_total").val():braintree_paypal_vars.order_total,t},is_payment_method_selected:function(){return!!e(t.container).find(t.token_selector).length&&""!==e(t.container).find(t.token_selector).val()},remove_method:function(){t.payment_method_received=!1,t.change_order_button_text(null,braintree_paypal_vars.gateway_id),e(t.container).find(t.nonce_selector).val(""),e(t.container).find(t.tokenized_selector).slideUp(400,function(){e(this).empty(),e(t.container).find(".braintree-paypal-button").slideDown(400)})},submit_error:function(a){e(document.body).triggerHandler("bfwc_submit_error",{error:a,element:t.container})},checkout_error:function(){t.is_gateway_selected()&&(t.payment_method_received=!1,t.remove_method())},woocommerce_form_submit:function(e){return!!t.is_payment_method_selected()||!!t.payment_method_received},is_gateway_selected:function(){return e('input[name="payment_method"]:checked').val()===braintree_paypal_vars.gateway_id},is_checkout_flow:function(){return"checkout"===braintree_paypal_vars.options.flow},set_device_data:function(){return t.dataCollectorInstance&&e(t.container).find(t.device_data_selector).val(t.dataCollectorInstance.deviceData),!0},change_order_button_text:function(a,n){var o=e("#place_order");if(n===braintree_paypal_vars.gateway_id&&!t.payment_method_received&&!t.is_payment_method_selected())return o.val(braintree_paypal_vars.order_button_text),o.addClass("bfwc-paypal-tokenize"),!0;o.removeClass("bfwc-paypal-tokenize")},display_new_method:function(){t.is_gateway_selected()&&t.change_order_button_text(null,braintree_paypal_vars.gateway_id)},display_saved_methods:function(){if(t.is_gateway_selected()){var a=e("#place_order");a.val(t.order_button_text),a.removeClass("bfwc-paypal-tokenize")}}};t.init()}});