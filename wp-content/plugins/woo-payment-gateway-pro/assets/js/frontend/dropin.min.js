jQuery(function(a){if("undefined"!=typeof braintree_dropin_vars){var b={braintree:{},container:".payment_method_"+braintree_dropin_vars.gateway_id,new_method_container:".bfwc-new-payment-method-container",token_selector:".bfwc-payment-method-token",nonce_selector:".bfwc-nonce-value",device_data_selector:".bfwc-device-data",saved_method_container:".bfwc-payment-method-container",dropin_id:"#braintree-dropin-form",init:function(){this.assign_parent_class(),setInterval(this.check_dropin_form,2e3),setInterval(this.remove_extra_frames,500),a(document.body).on("change",'input[name="payment_method"]',b.payment_gateway_change),a(b.container).closest("form").on("checkout_place_order_"+braintree_dropin_vars.gateway_id,this.woocommerce_form_submit),a(document.body).on("updated_checkout",this.check_dropin_form),a(document.body).on("checkout_error",this.checkout_error),a(document.body).on("updated_checkout",this.maybe_update_vars),a(document.body).on("bfwc_display_new_payment_method_container",b.display_dropin),a(document.body).on("bfwc_display_saved_methods",b.display_saved_methods),a(b.container).closest("form").on("woocommerce_form_submit_"+braintree_dropin_vars.gateway_id,this.woocommerce_form_submit),a(b.container).closest("form").on("woocommerce_form_submit_"+braintree_dropin_vars.gateway_id,this.set_device_data),a(document.body).on("bfwc_pre_form_submit_"+braintree_dropin_vars.gateway_id,this.set_device_data),a(document.body).on("init_add_payment_method",this.initialize_dropin),this.has_payment_methods()||this.initialize_dropin(),this.initialize_3d_secure()},assign_parent_class:function(){a('input[name="payment_method"]').each(function(){var b=a(this).val();a(this).closest("li").hasClass("payment_method_"+b)||a(this).closest("li").addClass("payment_method_"+b)})},initialize_dropin:function(){if(a(b.container).length){var c={container:"braintree-dropin-form",onReady:function(a){b.braintree.integration=a},onError:function(a){b.is_gateway_selected()&&b.submit_error(a)},onPaymentMethodReceived:function(a){"PayPalAccount"!==a.type&&braintree_dropin_vars._3ds.active?b.process_3ds_response(a):b.on_payment_method_received(a)}};braintree_dropin_vars.advanced_fraud.enabled&&(c.dataCollector={kount:{environment:braintree_dropin_vars.environment},paypal:!0}),braintree.setup(braintree_dropin_client_token,"dropin",c)}},initialize_3d_secure:function(){braintree_dropin_vars._3ds.enabled&&(b.braintree.client=new braintree.api.Client({clientToken:braintree_dropin_client_token}))},teardown_dropin:function(a){if(b.braintree.integration){if(b.braintree.teardown_called)return;b.braintree.teardown_called=!0;try{b.braintree.integration.teardown(function(){b.braintree.teardown_called=!1,a&&a()})}catch(a){b.braintree.teardown_called=!1}}},submit_error:function(c){a(document.body).triggerHandler("bfwc_submit_error",{error:c,element:b.container})},on_payment_method_received:function(c){b.payment_method_received=!0,a(b.container).find(b.nonce_selector).val(c.nonce),a(b.container).closest("form").submit()},process_3ds_response:function(c){b.braintree.client.verify3DS({amount:a("#bfwc_cart_total").length?a("#bfwc_cart_total").val():braintree_dropin_vars.order_total,creditCard:c.nonce,onUserClose:function(){b.unblock_form(),b.teardown_dropin(function(){b.initialize_dropin()})}},function(a,c){a?b.submit_error(a):b.on_payment_method_received(c)})},process_3dsecure_vaulted:function(){b.block_form(),a.when(b.payment_nonce_request(b.get_payment_token())).done(function(a){a.success?b.process_3ds_response({nonce:a.data}):(b.submit_error(a.data),b.unblock_form())}).fail(function(a,c,d){b.submit_error({message:d}),b.unblock_form()})},woocommerce_form_submit:function(a){return b.is_payment_method_selected()?!braintree_dropin_vars._3ds.active||!braintree_dropin_vars._3ds.verify_vault||(!!b.payment_method_received||(b.process_3dsecure_vaulted(),!1)):!!b.payment_method_received},check_dropin_form:function(){if(b.is_gateway_selected()&&(b.assign_parent_class(),!b.has_payment_methods()||!b.is_payment_method_selected())){a(b.dropin_id).find("iFrame").length||b.initialize_dropin()}},remove_extra_frames:function(){a.each(a(b.dropin_id).find("iFrame"),function(b){b>0&&a(this).remove()})},has_payment_methods:function(){return a(b.container).find(b.saved_method_container).length>0},is_payment_method_selected:function(){return a(b.container).find(b.token_selector).length>0&&""!==a(b.container).find(b.token_selector).val()},display_dropin:function(a){a.preventDefault(),b.initialize_dropin()},display_saved_methods:function(a){a.preventDefault(),b.teardown_dropin()},payment_gateway_change:function(c){a("#payment_method_"+braintree_dropin_vars.gateway_id).is(":checked")?b.has_payment_methods()?b.display_saved_methods(c):b.display_dropin(c):b.braintree.integration&&b.teardown_dropin()},is_gateway_selected:function(){return a('input[name="payment_method"]:checked').val()===braintree_dropin_vars.gateway_id},block_form:function(){a(b.container).closest("form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock_form:function(){a(b.container).closest("form").unblock()},get_payment_token:function(){return a(b.container).find(b.token_selector).val()},checkout_error:function(){b.payment_method_received=!1,"none"!==a(b.container).css("display")&&b.teardown_dropin(function(){b.initialize_dropin()})},maybe_update_vars:function(c){if(braintree_dropin_vars._3ds.enabled){b.block_form();var d={bfwc_handle:"dropin",security:braintree_dropin_vars.update_checkout_nonce,billing_country:a("#billing_country").val(),shipping_country:a("#shipping_country").val()};a.ajax({type:"POST",url:braintree_dropin_vars.wc_ajax_url.toString().replace("%%endpoint%%","bfwc_updated_checkout"),data:d,success:function(a){b.unblock_form(),a.success&&(braintree_dropin_vars=a.data)},error:function(a,c,d){b.unblock_form()}})}},payment_nonce_request:function(b){return a.ajax({type:"POST",url:braintree_dropin_vars.wc_ajax_url.toString().replace("%%endpoint%%","generate_payment_nonce"),data:{security:braintree_dropin_vars.payment_method_nonce,bfwc_payment_token:b}})},set_device_data:function(){return b.braintree.integration&&braintree_dropin_vars.advanced_fraud.enabled&&a(b.container).find(b.device_data_selector).val(b.braintree.integration.deviceData),!0}};b.init()}});