jQuery(function(e){if("undefined"!=typeof braintree_paypal_credit_vars){var t={container:"li.payment_method_"+braintree_paypal_credit_vars.gateway_id,button_id:"#braintree_paypal_credit_button",tokenized_selector:".bfwc-tokenized-paypal-method",nonce_selector:".bfwc-nonce-value",device_data_selector:".bfwc-device-data",init:function(){this.order_button_text=e("#place_order").val(),this.assign_parent_class(),e(document.body).on("bfwc_payment_method_selected",t.change_order_button_text),e(document.body).on("click",t.button_id+", .bfwc-paypal-credit-tokenize",t.tokenize_method),e(document.body).on("click",".bfwc-paypal-credit-cancel",t.remove_method),e(document.body).on("updated_checkout",this.check_paypal),e(document.body).on("checkout_error",this.checkout_error),e(t.container).closest("form").on("checkout_place_order_"+braintree_paypal_credit_vars.gateway_id,this.woocommerce_form_submit),e(document.body).on("updated_checkout",this.maybe_update_vars),e(document.body).on("bfwc_pre_form_submit_"+braintree_paypal_credit_vars.gateway_id,this.set_device_data),this.initialize_paypal()},assign_parent_class:function(){e('input[name="payment_method"]').each(function(){var t=e(this).val();e(this).closest("li").hasClass("payment_method_"+t)||e(this).closest("li").addClass("payment_method_"+t)})},initialize_paypal:function(){"undefined"!=typeof braintree_paypal_credit_client_token?braintree.client.create({authorization:braintree_paypal_credit_client_token},function(e,a){e?t.submit_error(e):(t.clientInstance=a,t.initialize_fraud_tools(),braintree.paypal.create({client:a},function(e,a){e?t.submit_error(e):t.paypalInstance=a}))}):this.submit_error({code:"INVALID_CLIENT_TOKEN"})},initialize_fraud_tools:function(){braintree.dataCollector.create({client:t.clientInstance,paypal:!0},function(e,a){e?t.submit_error(e):t.dataCollectorInstance=a})},tokenize_method:function(e){e.preventDefault(),t.paypalInstance.tokenize(t.get_tokenization_options(),function(e,a){if(e){if("PAYPAL_POPUP_CLOSED"===e.code)return;return"PAYPAL_INVALID_PAYMENT_OPTION"===e.code&&e.details.originalError.details.originalError.paymentResource.errorDetails&&(e.code=e.code+"_ADDRESS"),void t.submit_error(e)}t.on_payment_method_recieved(a)})},on_payment_method_recieved:function(a){t.payment_method_received=!0;var n=e(t.container).find(t.tokenized_selector),r=e(braintree_paypal_credit_vars.html);e(r).find(".payment-method-description").text(a.details.email),n.append(r),e(t.container).find(".braintree-paypal-button").slideUp(400),n.slideDown(400),e(t.container).find(t.nonce_selector).val(a.nonce),e("#place_order").removeClass("bfwc-paypal-credit-tokenize").val(t.order_button_text),braintree_paypal_credit_vars.form.submit&&e(t.container).closest("form").submit()},get_tokenization_options:function(){var t=braintree_paypal_credit_vars.options;if(t.enableShippingAddress&&(e('[name^="shipping_"]').length||e('[name^="billing_"]').length)){var a=e('[name^="shipping_"]').length&&e('[name="ship_to_different_address"]').is(":checked")?"#shipping_":"#billing_";t.shippingAddressOverride={recipientName:e(a+"first_name").val()+" "+e(a+"last_name").val(),line1:e(a+"address_1").val(),line2:e(a+"address_2").val(),city:e(a+"city").val(),countryCode:e(a+"country").val(),postalCode:e(a+"postcode").val(),state:e(a+"state").val(),phone:e(a+"phone").val()}}return t.amount=e("#bfwc_cart_total").length?e("#bfwc_cart_total").val():braintree_paypal_credit_vars.order_total,t},remove_method:function(){t.payment_method_received=!1,t.change_order_button_text(null,braintree_paypal_credit_vars.gateway_id),e(t.container).find(t.nonce_selector).val(""),e(t.container).find(t.tokenized_selector).slideUp(400,function(){e(this).empty(),e(t.container).find(".braintree-paypal-button").slideDown(400)})},submit_error:function(a){e(document.body).triggerHandler("bfwc_submit_error",{error:a,element:t.container})},checkout_error:function(){t.is_gateway_selected()&&(t.payment_method_received=!1,t.remove_method())},is_gateway_selected:function(){return e('input[name="payment_method"]:checked').val()===braintree_paypal_credit_vars.gateway_id},woocommerce_form_submit:function(e){return!!t.payment_method_received},maybe_update_vars:function(a){if(braintree_paypal_credit_vars.paypal_credit.enabled){e(t.container).closest("form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var n={bfwc_handle:"paypal-credit",security:braintree_paypal_credit_vars.update_checkout_nonce,billing_country:e("#billing_country").val(),shipping_country:e("#shipping_country").val()};e.ajax({type:"POST",url:braintree_paypal_credit_vars.wc_ajax_url.toString().replace("%%endpoint%%","bfwc_updated_checkout"),data:n,success:function(a){e(t.container).closest("form").unblock(),a.success&&(braintree_paypal_credit_vars=a.data,braintree_paypal_credit_vars.paypal_credit.active?e(t.container).length||e("ul.payment_methods").append(braintree_paypal_credit_vars.gateway_html):e(t.container).remove())},error:function(a,n,r){e(t.container).closest("form").unblock()}})}},set_device_data:function(){return t.dataCollectorInstance&&e(t.container).find(t.device_data_selector).val(t.dataCollectorInstance.deviceData),!0},change_order_button_text:function(a,n){var r=e("#place_order");if(n===braintree_paypal_credit_vars.gateway_id&&!t.payment_method_received)return r.val(braintree_paypal_credit_vars.order_button_text),r.addClass("bfwc-paypal-credit-tokenize"),!0;r.removeClass("bfwc-paypal-credit-tokenize")}};t.init()}});