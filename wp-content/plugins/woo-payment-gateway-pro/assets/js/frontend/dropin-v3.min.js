jQuery(function(a){if("undefined"!=typeof braintree_dropin_v3_vars){var b={container:".payment_method_"+braintree_dropin_v3_vars.gateway_id,new_method_container:".bfwc-new-payment-method-container",token_selector:".bfwc-payment-method-token",nonce_selector:".bfwc-nonce-value",device_data_selector:".bfwc-device-data",saved_method_container:".bfwc-payment-method-container",dropin_id:"#braintree-dropin-form",init:function(){setInterval(this.check_dropin_form,1500),a(document.body).on("click","#place_order",this.submit_payment_method),a(b.container).closest("form").on("checkout_place_order_"+braintree_dropin_v3_vars.gateway_id,this.woocommerce_form_submit),a(document.body).on("updated_checkout",this.check_dropin_form),a(document.body).on("updated_checkout",this.maybe_update_vars),a(b.container).closest("form").on("woocommerce_form_submit_"+braintree_dropin_v3_vars.gateway_id,this.woocommerce_form_submit),a(document.body).on("bfwc_pre_form_submit_"+braintree_dropin_v3_vars.gateway_id,this.maybe_set_device_data),a(document.body).on("checkout_error",this.checkout_error),this.initialize_dropin()},assign_parent_class:function(){a('input[name="payment_method"]').each(function(){var b=a(this).val();a(this).closest("li").hasClass("payment_method_"+b)||a(this).closest("li").addClass("payment_method_"+b)})},check_dropin_form:function(){b.assign_parent_class(),a(b.container).find(b.dropin_id).find("iFrame").length||b.initialize_dropin()},initialize_dropin:function(){if(a(b.container).length)return"undefined"==typeof braintree_dropin_v3_client_token?void this.submit_error({code:"INVALID_CLIENT_TOKEN"}):void braintree.dropin.create({authorization:braintree_dropin_v3_client_token,selector:b.dropin_id,locale:braintree_dropin_v3_vars.locale},function(a,c){if(a){if(a.message.match(/empty DOM node/))return;return void b.submit_error(a)}b.dropinInstance=c,b.initialize_fraud_tools(),b.initialize_3d_secure()})},initialize_fraud_tools:function(){braintree_dropin_v3_vars.advanced_fraud.enabled&&braintree.dataCollector.create({client:b.dropinInstance._client,kount:!0,paypal:!0},function(a,c){if(a)return void b.submit_error(a);b.dataCollectorInstance=c})},initialize_3d_secure:function(){braintree_dropin_v3_vars._3ds.enabled&&braintree.threeDSecure.create({client:b.dropinInstance._client},function(c,d){if(c)return b.threeds_error=c,void b.submit_error(c);b.threeDSecureInstance=d,a("body").addClass("bfwc-3ds")})},submit_payment_method:function(c){if(b.is_gateway_selected())if(b.is_payment_method_selected()){if(a(document.body).triggerHandler("braintree_checkout_initiated"),!braintree_dropin_v3_vars._3ds.active||!braintree_dropin_v3_vars._3ds.verify_vault)return!0;c.preventDefault(),b.process_3dsecure_vaulted()}else c.preventDefault(),b.tokenize_method()},tokenize_method:function(){a(document.body).triggerHandler("braintree_checkout_initiated"),b.dropinInstance&&b.dropinInstance.requestPaymentMethod(function(a,c){if(a)return void b.submit_error(a);braintree_dropin_v3_vars._3ds.active?b.process_3dsecure(c):b.on_payment_method_received(c)})},process_3dsecure:function(c){b.threeDSecureInstance?b.threeDSecureInstance.verifyCard({amount:a("#bfwc_cart_total").length?a("#bfwc_cart_total").val():braintree_dropin_v3_vars.order_total,nonce:c.nonce,addFrame:b.add_3ds_frame,removeFrame:b.remove_3ds_frame},function(a,c){if(a)return void b.submit_error(a);b.remove_3ds_frame(),b.on_payment_method_received(c)}):b.submit_error(b.threeds_error)},process_3dsecure_vaulted:function(){b.block_form(),a.when(b.payment_nonce_request(b.get_payment_token())).done(function(a){a.success?b.process_3dsecure({nonce:a.data}):(b.submit_error(a.data),b.unblock_form())}).fail(function(a,c,d){b.submit_error({message:d}),b.unblock_form()})},on_payment_method_received:function(c){b.payment_method_received=!0,a(b.container).find(b.nonce_selector).val(c.nonce),a(b.container).closest("form").submit()},woocommerce_form_submit:function(){return!!b.is_payment_method_selected()||!!b.payment_method_received},is_payment_method_selected:function(){return a(b.container).find(b.token_selector).length>0&&""!==a(b.container).find(b.token_selector).val()},is_gateway_selected:function(){return a('input[name="payment_method"]:checked').val()===braintree_dropin_v3_vars.gateway_id},get_payment_token:function(){return a(b.container).find(b.token_selector).val()},checkout_error:function(){b.dropinInstance&&b.dropinInstance.teardown(function(){b.payment_method_received=!1})},teardown:function(a){b.dropinInstance&&b.dropinInstance.teardown(a||function(){})},submit_error:function(c){a(document.body).triggerHandler("bfwc_submit_error",{error:c,element:b.container})},add_3ds_frame:function(c,d){if(c)return void b.submit_error(c);a("body").prepend('<div class="braintree-3ds-overlay"></div>'),a("body .braintree-3ds-overlay").fadeIn(400),a("body").prepend(braintree_dropin_v3_vars._3ds.modal_html),a(".threeDS-frame-body").append(d),a("#braintree_3ds_hosted_modal").fadeIn(400),a(".threeDS-cancel").on("click",b.cancel_3ds)},remove_3ds_frame:function(c){a("body .braintree-3ds-overlay").fadeOut(400,function(){a(this).remove()}),a("body .threeDS-hosted-modal").fadeOut(400,function(){a(this).remove()}),b.threeDSecureInstance.cancelVerifyCard(function(a,c){if(a)return void b.submit_error(a)})},cancel_3ds:function(){b.unblock_form(),b.remove_3ds_frame(),b.teardown()},block_form:function(){a(b.container).closest("form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock_form:function(){a(b.container).closest("form").unblock()},maybe_update_vars:function(c){if(braintree_dropin_v3_vars._3ds.enabled){b.block_form();var d={bfwc_handle:"dropin-v3",security:braintree_dropin_v3_vars.update_checkout_nonce,billing_country:a("#billing_country").val(),shipping_country:a("#shipping_country").val()};a.ajax({type:"POST",url:braintree_dropin_v3_vars.wc_ajax_url.toString().replace("%%endpoint%%","bfwc_updated_checkout"),data:d,success:function(a){b.unblock_form(),a.success&&(braintree_dropin_v3_vars=a.data)},error:function(a,c,d){b.unblock_form()}})}},payment_nonce_request:function(b){return a.ajax({type:"POST",url:braintree_dropin_v3_vars.wc_ajax_url.toString().replace("%%endpoint%%","generate_payment_nonce"),data:{security:braintree_dropin_v3_vars.payment_method_nonce,bfwc_payment_token:b}})},maybe_set_device_data:function(){return b.dataCollectorInstance&&a(b.container).find(b.device_data_selector).val(b.dataCollectorInstance.deviceData),!0}};b.init()}});