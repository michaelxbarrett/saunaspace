jQuery(function(a){if("undefined"!=typeof braintree_applepay_vars){var b={warning_container:"#braintree-applepay-warning",applepay_button:"#braintree-applepay-button",container:".payment_method_"+braintree_applepay_vars.gateway_id,nonce_selector:".bfwc-nonce-value",token_selector:".bfwc-payment-method-token",init:function(){this.assign_parent_class(),setInterval(this.check_setup,1500),a(b.container).closest("form").on("checkout_place_order_"+braintree_applepay_vars.gateway_id,this.woocommerce_form_submit),a(document.body).on("updated_checkout",this.check_setup),a(document.body).on("checkout_error",this.checkout_error),a(b.container).closest("form").on("woocommerce_form_submit_"+braintree_applepay_vars.gateway_id,this.woocommerce_form_submit),a(document.body).on("bfwc_display_new_payment_method_container",this.maybe_show_warning),this.setup_applepay()},assign_parent_class:function(){a('input[name="payment_method"]').each(function(){var b=a(this).val();a(this).closest("li").hasClass("payment_method_"+b)||a(this).closest("li").addClass("payment_method_"+b)})},setup_applepay:function(){if(a(b.container).length)return"undefined"==typeof braintree_applepay_client_token?void this.submit_error({code:"INVALID_CLIENT_TOKEN"}):void(this.can_initialize_applepay()?braintree.client.create({authorization:braintree_applepay_client_token},function(c,d){if(c)return void b.submit_error(c);braintree.applePay.create({client:d},function(c,d){if(c)return void b.submit_error(c);b.applePayInstance=d,ApplePaySession.canMakePaymentsWithActiveCard(d.merchantIdentifier).then(function(c){a(document.body).on("click",b.applepay_button,b.tokenize_method)})})}):b.show_warning())},tokenize_method:function(c){if(c.preventDefault(),b.can_initialize_applepay()){var d=b.applePayInstance.createPaymentRequest({total:{label:braintree_applepay_vars.store_name,amount:braintree_applepay_vars.order_total}});try{var e=new ApplePaySession(1,d)}catch(a){return void b.submit_error(a)}e.onvalidatemerchant=function(a){b.applePayInstance.performValidation({validationURL:a.validationURL,displayName:braintree_applepay_vars.store_name},function(a,c){if(a)return b.submit_error(a),void e.abort();e.completeMerchantValidation(c)})},e.onpaymentauthorized=function(c){b.applePayInstance.tokenize({token:c.payment.token},function(c,d){if(c)return b.submit_error(c),void e.completePayment(ApplePaySession.STATUS_FAILURE);e.completePayment(ApplePaySession.STATUS_SUCCESS),a(b.container).find(b.nonce_selector).val(d.nonce),b.payment_method_received=!0,a(b.container).closest("form").submit()})},e.begin()}},can_initialize_applepay:function(){return window.ApplePaySession&&ApplePaySession.canMakePayments()},check_setup:function(a){b.maybe_show_warning()},submit_error:function(c){a(document.body).triggerHandler("bfwc_submit_error",{error:c,element:b.container})},woocommerce_form_submit:function(){return!!b.is_payment_method_selected()||!!b.payment_method_received},is_payment_method_selected:function(){return a(b.container).find(b.token_selector).length>0&&""!==a(b.container).find(b.token_selector).val()},checkout_error:function(){b.payment_method_received=!1},show_warning:function(){a(b.applepay_button).off(),a(b.applepay_button).on("click",function(a){a.preventDefault()}),a(b.applepay_button).slideUp(300,function(){a(b.warning_container).slideDown(300)})},maybe_show_warning:function(){b.can_initialize_applepay()?b.display_button():b.show_warning()},display_button:function(){a(b.warning_container).slideUp(300,function(){a(b.applepay_button).slideDown(300)})}};b.init()}});